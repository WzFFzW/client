<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Nohost</title>
    <style>
      html, body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }
      .disabled .action-btn {
        color: #ccc;
        cursor: not-allowed;
      }
      main {
        text-align: center;
        width: 200px;
        height: 80px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -40px 0 0 -100px;
      }
      main button {
        width: 180px;
        height: 46px;
        font-size: 20px;
      }
      main button {
        background-color: #fe9455;
        color: #fff;
        border: none;
        border-radius: 2px;
        cursor: pointer;
        outline: none;
      }
      main button:hover {
        background-color: #f3803b;
      }
      main button:active {
        background-color: #ee7946;
      }
      main.enabled button {
        background-color: #188eee;
      }
      main.enabled button:hover {
        background-color: #147de2;
      }
      main.enabled button:active {
        background-color: #1774c9;
      }
      .action-bar {
        margin-top: 15px;
      }
      .action-bar a {
        margin: 0 8px;
      }
    </style>
    <script>
      window.onbeforeunload = () => '';
    </script>
    <script>
      const lan = require('lan-settings');
      const { shell } = require('electron');

      const $ = (id) => {
        return document.getElementById(id);
      };
      let settingsWin;
      const openSettings = () => {
        if (!settingsWin || settingsWin.closed) {
          settingsWin = window.open('http://local.wproxy.org/', null, 'width=1080');
        }
        settingsWin.focus();
      };
      let selectEnvWin;
      const openSelectEnv = () => {
        if (!selectEnvWin || selectEnvWin.closed) {
          selectEnvWin = window.open('http://imweb.nohost.pro/select.html');
        }
        selectEnvWin.focus();
      };
      const openHelp = () => {
        shell.openExternal('http://git.code.oa.com/imweb/nohost-client');
      };
    </script>
  </head>
  <body>
    <main id="main" class="disabled">
      <button id="switchProxy" onclick="switchProxy(event)">启用</button>
      <div class="action-bar">
        <a class="action-btn" href="javascript:;" onclick="openSettings()">设置</a>
        <a class="action-btn" href="javascript:;" onclick="openSelectEnv()">选择环境</a>
        <a href="javascript:;" onclick="openHelp()" >
          帮助
        </a>
      </div>
    </main>
    <script>
      const nohost = require('./lib');
      const switchProxy = () => {
        const btn = $('switchProxy');
        const main = $('main');
        if (main.className === 'enabled') {
          main.className = 'disabled';
          btn.innerHTML = '启用';
        } else {
          main.className = 'enabled';
          btn.innerHTML = '关闭';
        }
      };
      nohost.init();
    </script>
    <script>
        window.onbeforeunload = (e) => {
          if (!pending || $('main').className === 'disabled') {
            return;
          }
          process.nextTick(() => {
            if (confirm('退出后将不能使用Nohost，确定退出？')) {
              switchProxy();
              window.close();
            }
          });
          return '';
        };
      </script>
  </body>
</html>
